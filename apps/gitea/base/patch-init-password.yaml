# Add DB password to init-app-ini (index 1)
- op: add
  path: /spec/template/spec/initContainers/1/env/-
  value:
    name: GITEA__DATABASE__PASSWD
    valueFrom:
      secretKeyRef:
        name: gitea-db-secret
        key: password

# Add cache/session overrides to init-app-ini (index 1)
- op: add
  path: /spec/template/spec/initContainers/1/env/-
  value: { name: GITEA__CACHE__ADAPTER, value: memory }
- op: add
  path: /spec/template/spec/initContainers/1/env/-
  value: { name: GITEA__SESSION__PROVIDER, value: file }

# Keep the DB password on configure-gitea (index 2)
- op: add
  path: /spec/template/spec/initContainers/2/env/-
  value:
    name: GITEA__DATABASE__PASSWD
    valueFrom:
      secretKeyRef:
        name: gitea-db-secret
        key: password

# And mirror cache/session on configure-gitea (index 2)
- op: add
  path: /spec/template/spec/initContainers/2/env/-
  value: { name: GITEA__CACHE__ADAPTER, value: memory }
- op: add
  path: /spec/template/spec/initContainers/2/env/-
  value: { name: GITEA__SESSION__PROVIDER, value: file }

# init-app-ini (index 1)
- op: add
  path: /spec/template/spec/initContainers/1/env/-
  value: { name: GITEA__QUEUE__TYPE, value: immediate }

# configure-gitea (index 2)
- op: add
  path: /spec/template/spec/initContainers/2/env/-
  value: { name: GITEA__QUEUE__TYPE, value: immediate }
